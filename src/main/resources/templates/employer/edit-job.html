<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- ============================================
     EMPLOYER EDIT JOB PAGE
     ============================================
     This page provides a form for employers to edit
     their existing job postings.

     Features:
     - Pre-filled form with current job data
     - Validation for all fields
     - Displays validation errors
     - Form submits to /employer/jobs/edit/{jobId}
     - Shows current job status

     The controller passes a "job" object with existing data
     ============================================ -->

<head th:replace="fragments/header :: head">
    <!-- Import head section with CSS and meta tags -->
</head>

<body>
<!-- ============================================
     NAVIGATION BAR
     ============================================ -->
<nav th:replace="fragments/header :: header"></nav>

<!-- ============================================
     MAIN CONTENT CONTAINER
     ============================================ -->
<div class="container">

    <!-- ============================================
         PAGE HEADER
         ============================================ -->
    <div class="card">
        <div class="card-header d-flex justify-between align-center">
            <h2>
                <i class="fas fa-edit"></i>
                Edit Job Posting
            </h2>

            <!-- Show current status -->
            <span class="badge"
                  th:classappend="${job.status == T(com.campusboard.campusboard.models.Job.Status).APPROVED} ? 'badge-approved' :
                                     ${job.status == T(com.campusboard.campusboard.models.Job.Status).PENDING} ? 'badge-pending' :
                                     'badge-rejected'"
                  th:text="${job.status}">
                    PENDING
                </span>
        </div>
        <p>
            Update your job posting details below.
            Changes may require admin re-approval before being visible to students.
        </p>
    </div>

    <!-- ============================================
         JOB EDIT FORM
         ============================================
         Uses Thymeleaf's form binding with th:object
         Form is pre-filled with existing job data
         Submits POST request to /employer/jobs/edit/{jobId} -->
    <div class="card">

        <form th:action="@{/employer/jobs/edit/{id}(id=${job.jobId})}"
              th:object="${job}"
              method="post">

            <!-- =====================
                 JOB TITLE FIELD
                 =====================
                 Required field with validation
                 Pre-filled with existing title -->
            <div class="form-group">
                <label for="title">
                    Job Title <span style="color: red;">*</span>
                </label>
                <input type="text"
                       id="title"
                       th:field="*{title}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('title')} ? 'field-error' : ''"
                       placeholder="e.g., Library Assistant, Research Assistant"
                       required>

                <!-- Display validation error if exists -->
                <div class="error-message" th:if="${#fields.hasErrors('title')}">
                    <i class="fas fa-exclamation-circle"></i>
                    <span th:errors="*{title}">Title error</span>
                </div>
            </div>

            <!-- =====================
                 JOB DESCRIPTION FIELD
                 =====================
                 Required textarea for detailed description
                 Pre-filled with existing description -->
            <div class="form-group">
                <label for="description">
                    Job Description <span style="color: red;">*</span>
                </label>
                <textarea id="description"
                          th:field="*{description}"
                          class="form-control"
                          th:classappend="${#fields.hasErrors('description')} ? 'field-error' : ''"
                          rows="8"
                          placeholder="Provide a detailed description..."
                          required></textarea>

                <!-- Display validation error if exists -->
                <div class="error-message" th:if="${#fields.hasErrors('description')}">
                    <i class="fas fa-exclamation-circle"></i>
                    <span th:errors="*{description}">Description error</span>
                </div>

                <!-- Help text -->
                <small style="color: #666;">
                    <i class="fas fa-info-circle"></i>
                    Include responsibilities, requirements, and qualifications.
                </small>
            </div>

            <!-- =====================
                 LOCATION FIELD
                 =====================
                 Optional field, pre-filled if exists -->
            <div class="form-group">
                <label for="location">Location</label>
                <input type="text"
                       id="location"
                       th:field="*{location}"
                       class="form-control"
                       placeholder="e.g., Main Library, Science Building">
                <small style="color: #666;">
                    <i class="fas fa-info-circle"></i>
                    Specify the job location on campus.
                </small>
            </div>

            <!-- =====================
                 TWO-COLUMN LAYOUT
                 =====================
                 Salary and Category side by side -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">

                <!-- SALARY FIELD -->
                <div class="form-group">
                    <label for="salary">Hourly Wage ($)</label>
                    <input type="number"
                           id="salary"
                           th:field="*{salary}"
                           class="form-control"
                           step="0.01"
                           min="0"
                           placeholder="e.g., 15.50">
                    <small style="color: #666;">
                        <i class="fas fa-info-circle"></i>
                        Enter hourly rate in dollars.
                    </small>
                </div>

                <!-- CATEGORY FIELD -->
                <div class="form-group">
                    <label for="category">Job Category</label>
                    <select id="category"
                            th:field="*{category}"
                            class="form-control">
                        <option value="">-- Select Category --</option>
                        <option value="Administrative">Administrative</option>
                        <option value="Research">Research</option>
                        <option value="Technical">Technical</option>
                        <option value="Library">Library</option>
                        <option value="Food Service">Food Service</option>
                        <option value="Tutoring">Tutoring</option>
                        <option value="Event Support">Event Support</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Other">Other</option>
                    </select>
                    <small style="color: #666;">
                        <i class="fas fa-info-circle"></i>
                        Select the appropriate category.
                    </small>
                </div>
            </div>

            <!-- =====================
                 APPLICATION DEADLINE FIELD
                 =====================
                 Date input for application deadline
                 Pre-filled if exists -->
            <div class="form-group">
                <label for="deadline">Application Deadline</label>
                <input type="date"
                       id="deadline"
                       th:field="*{deadline}"
                       class="form-control">
                <small style="color: #666;">
                    <i class="fas fa-info-circle"></i>
                    Set when applications will close.
                </small>
            </div>

            <!-- =====================
                 WARNING ALERT
                 =====================
                 Inform about re-approval if status is APPROVED -->
            <div class="alert alert-warning"
                 th:if="${job.status == T(com.campusboard.campusboard.models.Job.Status).APPROVED}">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Important:</strong> This job is currently APPROVED and visible to students.
                Making changes may reset it to PENDING status and require admin re-approval.
            </div>

            <!-- Information for REJECTED jobs -->
            <div class="alert alert-info"
                 th:if="${job.status == T(com.campusboard.campusboard.models.Job.Status).REJECTED}">
                <i class="fas fa-info-circle"></i>
                <strong>Note:</strong> This job was rejected. Make necessary improvements
                and submit again for admin review.
            </div>

            <!-- =====================
                 FORM BUTTONS
                 =====================
                 Update and Cancel buttons -->
            <div class="d-flex gap-2">
                <!-- Submit button -->
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Changes
                </button>

                <!-- Cancel button -->
                <a th:href="@{/employer/jobs}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>

        </form>

        <!-- =====================
             POSTING HISTORY
             =====================
             Show creation and update timestamps -->
        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #ddd; color: #999; font-size: 0.9rem;">
            <p>
                <i class="fas fa-clock"></i>
                Originally posted:
                <span th:text="${#temporals.format(job.createdAt, 'MMM dd, yyyy HH:mm')}">Date</span>
            </p>
            <p th:if="${job.updatedAt != null and job.updatedAt != job.createdAt}">
                <i class="fas fa-edit"></i>
                Last modified:
                <span th:text="${#temporals.format(job.updatedAt, 'MMM dd, yyyy HH:mm')}">Date</span>
            </p>
        </div>
    </div>

</div>

<!-- ============================================
     FOOTER
     ============================================ -->
<footer th:replace="fragments/footer :: footer"></footer>

</body>
</html>