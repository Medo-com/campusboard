<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- ============================================
     STUDENT JOB DETAILS PAGE
     ============================================ -->

<head th:replace="fragments/header :: head"></head>

<body>

<nav th:replace="fragments/header :: header"></nav>

<div class="container">

    <!-- SUCCESS MESSAGE -->
    <div class="alert alert-success" th:if="${param.success}">
        <i class="fas fa-check-circle"></i>
        Application submitted successfully!
        Check "My Applications" to track its status.
    </div>

    <!-- ERROR MESSAGE -->
    <div class="alert alert-danger" th:if="${param.error}">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${param.error}">Error message</span>
    </div>

    <!-- JOB DETAILS CARD -->
    <div class="card">

        <div class="card-header">
            <h2>
                <i class="fas fa-briefcase"></i>
                <span th:text="${job.title}">Job Title</span>
            </h2>
        </div>

        <!-- EMPLOYER INFO -->
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 5px; margin-bottom: 2rem;">
            <h4><i class="fas fa-building"></i> Employer Information</h4>
            <p><strong>Posted by:</strong> <span th:text="${job.employer.fullName}">Employer Name</span></p>
            <p><strong>Contact:</strong> <span th:text="${job.employer.email}">email</span></p>
        </div>

        <!-- METADATA GRID -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">

            <div th:if="${job.location != null}">
                <h4><i class="fas fa-map-marker-alt"></i> Location</h4>
                <p th:text="${job.location}"></p>
            </div>

            <div th:if="${job.salary != null}">
                <h4><i class="fas fa-dollar-sign"></i> Salary</h4>
                <p>$<span th:text="${#numbers.formatDecimal(job.salary, 0, 2)}"></span> per hour</p>
            </div>

            <div th:if="${job.category != null}">
                <h4><i class="fas fa-tag"></i> Category</h4>
                <p th:text="${job.category}"></p>
            </div>

            <div th:if="${job.deadline != null}">
                <h4><i class="fas fa-calendar-alt"></i> Deadline</h4>
                <p th:text="${job.deadline}"></p>
            </div>
        </div>

        <!-- DESCRIPTION -->
        <div style="margin-bottom: 2rem;">
            <h3><i class="fas fa-align-left"></i> Job Description</h3>
            <div style="line-height: 1.8; color: #555; white-space: pre-line;">
                <p th:text="${job.description}"></p>
            </div>
        </div>

        <!-- JOB STATUS BADGE (FIXED!) -->
        <div style="margin-bottom: 2rem;">
            <h4>Status:</h4>

            <span class="badge"
                  th:classappend="${
                        job.status == T(com.campusboard.campusboard.models.Job.Status).APPROVED
                            ? ' badge-approved'
                            : (job.status == T(com.campusboard.campusboard.models.Job.Status).PENDING
                                ? ' badge-pending'
                                : ' badge-rejected')
                    }"
                  th:text="${job.status}">
            </span>
        </div>

        <!-- APPLICATION FORM -->
        <form th:action="@{/student/apply/{id}(id=${job.jobId})}"
              method="post"
              style="margin-top: 2rem;">

            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Note:</strong> You can only apply to each job once.
            </div>

            <button type="submit" class="btn btn-primary" style="font-size: 1.1rem; padding: 1rem 2rem;">
                <i class="fas fa-paper-plane"></i> Apply to This Position
            </button>

            <a th:href="@{/student/jobs}" class="btn btn-secondary" style="margin-left: 1rem;">
                <i class="fas fa-arrow-left"></i> Back to Job List
            </a>
        </form>

        <!-- TIMESTAMPS -->
        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #ddd; color: #999; font-size: 0.9rem;">
            <p>
                <i class="fas fa-clock"></i> Posted on:
                <span th:text="${#temporals.format(job.createdAt, 'MMM dd, yyyy HH:mm')}"></span>
            </p>
            <p th:if="${job.updatedAt != null and job.updatedAt != job.createdAt}">
                <i class="fas fa-edit"></i> Last updated:
                <span th:text="${#temporals.format(job.updatedAt, 'MMM dd, yyyy HH:mm')}"></span>
            </p>
        </div>

    </div>

</div>

<footer th:replace="fragments/footer :: footer"></footer>

</body>
</html>
