<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- ============================================
     STUDENT APPLICATIONS PAGE
     ============================================
     This page displays all job applications submitted
     by the currently logged-in student.

     Features:
     - Lists all applications with job details
     - Shows application status (SUBMITTED, ACCEPTED, REJECTED)
     - Displays when application was submitted
     - Shows empty state if no applications
     - Success message when redirected after applying

     The controller passes "applications" list to this template
     ============================================ -->

<head th:replace="fragments/header :: head">
    <!-- Import head section with CSS and meta tags -->
</head>

<body>
<!-- ============================================
     NAVIGATION BAR
     ============================================ -->
<nav th:replace="fragments/header :: header"></nav>

<!-- ============================================
     MAIN CONTENT CONTAINER
     ============================================ -->
<div class="container">

    <!-- ============================================
         SUCCESS MESSAGE
         ============================================
         Shown when redirected with ?success parameter
         Example: after successfully applying to a job -->
    <div class="alert alert-success" th:if="${param.success}">
        <i class="fas fa-check-circle"></i>
        Your application has been submitted successfully!
    </div>

    <!-- ============================================
         PAGE HEADER
         ============================================ -->
    <div class="card">
        <div class="card-header">
            <h2>
                <i class="fas fa-file-alt"></i>
                My Applications
            </h2>
        </div>
        <p>
            Track the status of all your job applications.
            You can see which positions you've applied to and their current status.
        </p>
    </div>

    <!-- ============================================
         APPLICATIONS TABLE
         ============================================
         Only displayed if applications list is not empty -->
    <div th:if="${applications != null and !applications.empty}">

        <!-- Table wrapper for responsive scrolling -->
        <div class="table-wrapper">

            <table class="table">

                <!-- =====================
                     TABLE HEADER
                     =====================
                     Column headers for the table -->
                <thead>
                <tr>
                    <th><i class="fas fa-hashtag"></i> #</th>
                    <th><i class="fas fa-briefcase"></i> Job Title</th>
                    <th><i class="fas fa-building"></i> Employer</th>
                    <th><i class="fas fa-map-marker-alt"></i> Location</th>
                    <th><i class="fas fa-dollar-sign"></i> Salary</th>
                    <th><i class="fas fa-info-circle"></i> Status</th>
                    <th><i class="fas fa-calendar"></i> Applied On</th>
                </tr>
                </thead>

                <!-- =====================
                     TABLE BODY
                     =====================
                     Loop through each application and display data -->
                <tbody>

                <!-- Loop through applications list
                     iterStat provides loop statistics (index, count, etc.) -->
                <tr th:each="app, iterStat : ${applications}">

                    <!-- APPLICATION NUMBER (1, 2, 3...) -->
                    <td th:text="${iterStat.count}">1</td>

                    <!-- JOB TITLE -->
                    <td>
                        <strong th:text="${app.job.title}">Job Title</strong>
                    </td>

                    <!-- EMPLOYER NAME -->
                    <td th:text="${app.job.employer.fullName}">
                        Employer Name
                    </td>

                    <!-- LOCATION -->
                    <td th:text="${app.job.location != null ? app.job.location : 'N/A'}">
                        Location
                    </td>

                    <!-- SALARY -->
                    <td>
                        <!-- Check if salary exists, otherwise show N/A -->
                        <span th:if="${app.job.salary != null}">
                                    $<span th:text="${#numbers.formatDecimal(app.job.salary, 0, 2)}">0.00</span>/hr
                                </span>
                        <span th:if="${app.job.salary == null}">N/A</span>
                    </td>

                    <!-- APPLICATION STATUS -->
                    <td>
                        <!-- Badge with different colors based on status
                             Uses conditional class binding -->
                        <span class="badge"
                              th:classappend="${app.status == T(com.campusboard.campusboard.models.JobApplication.Status).SUBMITTED} ? 'badge-submitted' :
                                                     ${app.status == T(com.campusboard.campusboard.models.JobApplication.Status).ACCEPTED} ? 'badge-approved' :
                                                     'badge-rejected'"
                              th:text="${app.status}">
                                    SUBMITTED
                                </span>
                    </td>

                    <!-- APPLICATION DATE -->
                    <td>
                        <!-- Format the date and time nicely -->
                        <span th:text="${#temporals.format(app.appliedAt, 'MMM dd, yyyy')}">
                                    Jan 01, 2025
                                </span>
                    </td>
                </tr>

                </tbody>
            </table>

        </div>

        <!-- =====================
             LEGEND FOR STATUS BADGES
             =====================
             Helps users understand status colors -->
        <div class="card mt-3">
            <h4 style="margin-bottom: 1rem;">
                <i class="fas fa-info-circle"></i> Status Legend
            </h4>
            <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
                <div>
                    <span class="badge badge-submitted">SUBMITTED</span>
                    <span style="margin-left: 0.5rem;">- Your application is under review</span>
                </div>
                <div>
                    <span class="badge badge-approved">ACCEPTED</span>
                    <span style="margin-left: 0.5rem;">- Congratulations! You've been accepted</span>
                </div>
                <div>
                    <span class="badge badge-rejected">REJECTED</span>
                    <span style="margin-left: 0.5rem;">- Unfortunately not selected this time</span>
                </div>
            </div>
        </div>

    </div>

    <!-- ============================================
         EMPTY STATE
         ============================================
         Displayed when student has no applications
         Uses th:if to check if list is empty or null -->
    <div class="empty-state" th:if="${applications == null or applications.empty}">
        <!-- Large icon for empty state -->
        <i class="fas fa-inbox"></i>

        <!-- Message to user -->
        <h3>No Applications Yet</h3>
        <p>
            You haven't applied to any jobs yet.
            Browse available positions and submit your applications!
        </p>

        <!-- Call-to-action button -->
        <a th:href="@{/student/jobs}" class="btn btn-primary" style="margin-top: 1rem;">
            <i class="fas fa-search"></i> Browse Available Jobs
        </a>
    </div>

</div>

<!-- ============================================
     FOOTER
     ============================================ -->
<footer th:replace="fragments/footer :: footer"></footer>

</body>
</html>