<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: head}"></head>

<body>

<nav th:replace="~{fragments/header :: header}"></nav>

<div class="container">

    <!-- SUCCESS MESSAGES -->
    <div class="alert alert-success" th:if="${param.activated}">
        <i class="fas fa-check-circle"></i> User account activated successfully!
    </div>

    <div class="alert alert-success" th:if="${param.deactivated}">
        <i class="fas fa-check-circle"></i> User account deactivated successfully!
    </div>

    <div class="card">
        <div class="card-header">
            <h2><i class="fas fa-users-cog"></i> User Management</h2>
        </div>
        <p>View and manage all registered users.</p>
    </div>

    <div th:if="${users != null and !users.empty}">

        <!-- SUMMARY -->
        <div class="card" style="background: #f8f9fa; margin-bottom: 2rem;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; text-align: center;">

                <div>
                    <h3 style="color: #667eea;" th:text="${#lists.size(users)}">0</h3>
                    <p>Total Users</p>
                </div>

                <div>
                    <h3 style="color: #28a745;">
                        <span th:text="${#lists.size(users.?[status == T(com.campusboard.campusboard.models.User.Status).ACTIVE])}"></span>
                    </h3>
                    <p>Active</p>
                </div>

                <div>
                    <h3 style="color: #dc3545;">
                        <span th:text="${#lists.size(users.?[status == T(com.campusboard.campusboard.models.User.Status).INACTIVE])}"></span>
                    </h3>
                    <p>Inactive</p>
                </div>

                <div>
                    <h3 style="color: #17a2b8;">
                        <span th:text="${#lists.size(users.?[role == T(com.campusboard.campusboard.models.User.Role).STUDENT])}"></span>
                    </h3>
                    <p>Students</p>
                </div>

                <div>
                    <h3 style="color: #ffc107;">
                        <span th:text="${#lists.size(users.?[role == T(com.campusboard.campusboard.models.User.Role).EMPLOYER])}"></span>
                    </h3>
                    <p>Employers</p>
                </div>

                <div>
                    <h3 style="color: #6f42c1;">
                        <span th:text="${#lists.size(users.?[role == T(com.campusboard.campusboard.models.User.Role).ADMIN])}"></span>
                    </h3>
                    <p>Admins</p>
                </div>
            </div>
        </div>

        <div class="table-wrapper">
            <table class="table">

                <thead>
                <tr>
                    <th>ID</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Joined</th>
                    <th>Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="user : ${users}">

                    <td th:text="${user.userId}"></td>

                    <td><strong th:text="${user.fullName}"></strong></td>

                    <td th:text="${user.email}"></td>

                    <!-- FIXED ROLE BADGE -->
                    <td>
                        <span class="badge"
                              th:classappend="${user.role == T(com.campusboard.campusboard.models.User.Role).ADMIN ? 'badge-rejected' :
                                              (user.role == T(com.campusboard.campusboard.models.User.Role).EMPLOYER ? 'badge-pending' :
                                              'badge-submitted')}"
                              th:text="${user.role}">
                        </span>
                    </td>

                    <!-- FIXED STATUS BADGE -->
                    <td>
                        <span class="badge"
                              th:classappend="${user.status == T(com.campusboard.campusboard.models.User.Status).ACTIVE ? 'badge-active' : 'badge-inactive'}"
                              th:text="${user.status}">
                        </span>
                    </td>

                    <td>
                        <span th:text="${#temporals.format(user.createdAt, 'MMM dd, yyyy')}"></span>
                    </td>

                    <td>

                        <!-- ACTIVATE BUTTON -->
                        <form th:if="${user.status == T(com.campusboard.campusboard.models.User.Status).INACTIVE}"
                              th:action="@{/admin/users/activate/{id}(id=${user.userId})}"
                              method="post" style="display:inline;">
                            <button type="submit" class="btn btn-success btn-sm">
                                <i class="fas fa-check"></i> Activate
                            </button>
                        </form>

                        <!-- DEACTIVATE BUTTON -->
                        <form th:if="${user.status == T(com.campusboard.campusboard.models.User.Status).ACTIVE}"
                              th:action="@{/admin/users/deactivate/{id}(id=${user.userId})}"
                              method="post" style="display:inline;"
                              onsubmit="return confirm('Are you sure you want to deactivate this user account?');">
                            <button type="submit" class="btn btn-danger btn-sm">
                                <i class="fas fa-ban"></i> Deactivate
                            </button>
                        </form>

                    </td>

                </tr>
                </tbody>

            </table>
        </div>

    </div>

    <div class="empty-state" th:if="${users == null or users.empty}">
        <i class="fas fa-users-slash"></i>
        <h3>No Users Found</h3>
        <p>There are no registered users in the system.</p>
    </div>

    <div class="card mt-3" th:if="${users != null and !users.empty}">
        <h4 style="color:#667eea;"><i class="fas fa-info-circle"></i> User Management Guidelines</h4>
        <ul style="line-height: 2;">
            <li><strong>Active Users</strong> can fully access the system.</li>
            <li><strong>Inactive Users</strong> are blocked from logging in.</li>
            <li><strong>Deactivation</strong> can be used for policy violations.</li>
            <li><strong>Reactivation</strong> restores access instantly.</li>
            <li>
                Roles:
                <span class="badge badge-submitted">STUDENT</span>
                <span class="badge badge-pending">EMPLOYER</span>
                <span class="badge badge-rejected">ADMIN</span>
            </li>
        </ul>
    </div>

    <div class="card mt-3" th:if="${users != null and !users.empty}">
        <h4><i class="fas fa-question-circle"></i> Status & Role Legend</h4>
        <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem;">
            <div><span class="badge badge-active">ACTIVE</span><p>User can access</p></div>
            <div><span class="badge badge-inactive">INACTIVE</span><p>User cannot log in</p></div>
            <div><span class="badge badge-submitted">STUDENT</span><p>Can browse/apply</p></div>
            <div><span class="badge badge-pending">EMPLOYER</span><p>Can create jobs</p></div>
            <div><span class="badge badge-rejected">ADMIN</span><p>Full access</p></div>
        </div>
    </div>

</div>

<footer th:replace="~{fragments/footer :: footer}"></footer>

</body>
</html>
